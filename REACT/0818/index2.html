<!DOCTYPE html>
<html lang="ko">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Modern Redux Color Changer</title>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/redux/4.0.1/redux.js"></script>
        <style>
            .container {
                border: 5px solid black;
                padding: 10px;
            }
        </style>
    </head>
    <body>
        <div id="red-component"></div>
        <div id="blue-component"></div>
        <div id="green-component"></div>

        <script>
            /**
             * =====================================================
             * REDUX CORE: REDUCER í•¨ìˆ˜
             * =====================================================
             * Reduxì˜ í•µì‹¬ - ìˆœìˆ˜ í•¨ìˆ˜ë¡œ ìƒíƒœ ë³€í™”ë¥¼ ì²˜ë¦¬
             *
             * ğŸ”¥ í•µì‹¬ ì›ì¹™:
             * 1. ìˆœìˆ˜ í•¨ìˆ˜: ê°™ì€ ì…ë ¥ì— ëŒ€í•´ í•­ìƒ ê°™ì€ ì¶œë ¥
             * 2. ë¶ˆë³€ì„±: ê¸°ì¡´ stateë¥¼ ì§ì ‘ ìˆ˜ì •í•˜ì§€ ì•Šê³  ìƒˆë¡œìš´ ê°ì²´ ë°˜í™˜
             * 3. ë¶€ìˆ˜ íš¨ê³¼ ì—†ìŒ: API í˜¸ì¶œ, DOM ì¡°ì‘ ë“± ê¸ˆì§€
             *
             * @param {Object} state - í˜„ì¬ ì• í”Œë¦¬ì¼€ì´ì…˜ ìƒíƒœ
             * @param {Object} action - ìƒíƒœ ë³€ê²½ ëª…ë ¹ ê°ì²´ (type í•„ìˆ˜)
             * @returns {Object} ìƒˆë¡œìš´ ìƒíƒœ ê°ì²´
             */
            const reducer = (state, action) => {
                console.log("ğŸ”„ Reducer í˜¸ì¶œ:", {
                    currentState: state,
                    action: action,
                    timestamp: new Date().toLocaleTimeString(),
                });

                // ì´ˆê¸° ìƒíƒœ ì„¤ì •
                // Redux store ìƒì„± ì‹œ ìë™ìœ¼ë¡œ í˜¸ì¶œë˜ë©°, ì´ë•Œ stateëŠ” undefined
                if (state === undefined) {
                    const initialState = { color: "yellow" };
                    console.log("ğŸŒŸ ì´ˆê¸° ìƒíƒœ ì„¤ì •:", initialState);
                    return initialState;
                }

                // Action íƒ€ì…ì— ë”°ë¥¸ ìƒíƒœ ë³€ê²½ ì²˜ë¦¬
                switch (action.type) {
                    case "CHANGE_COLOR":
                        console.log("ğŸ¨ ìƒ‰ìƒ ë³€ê²½:", `${state.color} â†’ ${action.color}`);

                        // ë¶ˆë³€ì„±ì„ ìœ„í•´ spread operator ì‚¬ìš© (ES6+)
                        // Object.assign ëŒ€ì‹  ë” í˜„ëŒ€ì ì¸ ë°©ì‹
                        const newState = {
                            ...state, // ê¸°ì¡´ ìƒíƒœì˜ ëª¨ë“  ì†ì„± ë³µì‚¬
                            color: action.color, // color ì†ì„±ë§Œ ìƒˆ ê°’ìœ¼ë¡œ ë®ì–´ì“°ê¸°
                        };

                        console.log("âœ… ìƒˆë¡œìš´ ìƒíƒœ ìƒì„±:", newState);
                        return newState;

                    default:
                        // ì•Œ ìˆ˜ ì—†ëŠ” action typeì¸ ê²½ìš° ê¸°ì¡´ ìƒíƒœ ê·¸ëŒ€ë¡œ ë°˜í™˜
                        console.log("âš ï¸ ì•Œ ìˆ˜ ì—†ëŠ” ì•¡ì…˜ íƒ€ì…:", action.type);
                        return state;
                }
            };

            /**
             * =====================================================
             * REDUX STORE ìƒì„± ë° ì„¤ì •
             * =====================================================
             * Redux store: ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ìƒíƒœë¥¼ ê´€ë¦¬í•˜ëŠ” ì¤‘ì•™ ì €ì¥ì†Œ
             */
            const store = Redux.createStore(
                reducer,
                // Redux DevTools Extension ì—°ë™ (ë¸Œë¼ìš°ì € í™•ì¥ í”„ë¡œê·¸ë¨)
                // ê°œë°œ ì¤‘ì—ë§Œ ì‚¬ìš©, í”„ë¡œë•ì…˜ì—ì„œëŠ” ì œê±° ê¶Œì¥
                window.__REDUX_DEVTOOLS_EXTENSION__ && window.__REDUX_DEVTOOLS_EXTENSION__()
            );

            console.log("ğŸª Redux Store ìƒì„± ì™„ë£Œ");
            console.log("ğŸ“Š ì´ˆê¸° ìƒíƒœ:", store.getState());

            /**
             * =====================================================
             * UTILITY FUNCTIONS
             * =====================================================
             */

            /**
             * ì•¡ì…˜ ìƒì„±ì í•¨ìˆ˜ (Action Creator)
             * ì•¡ì…˜ ê°ì²´ ìƒì„±ì„ ìœ„í•œ íŒ©í† ë¦¬ í•¨ìˆ˜
             * @param {string} color - ë³€ê²½í•  ìƒ‰ìƒ
             * @returns {Object} Redux ì•¡ì…˜ ê°ì²´
             */
            const changeColorAction = (color) => ({
                type: "CHANGE_COLOR",
                color: color,
                timestamp: Date.now(), // ì¶”ê°€ ë©”íƒ€ë°ì´í„°
            });

            /**
             * =====================================================
             * COMPONENT FUNCTIONS (View Layer)
             * =====================================================
             * ê° ì»´í¬ë„ŒíŠ¸ëŠ” ìì‹ ë§Œì˜ ë Œë”ë§ ë¡œì§ì„ ê°€ì§
             * Redux ìƒíƒœê°€ ë³€ê²½ë  ë•Œë§ˆë‹¤ ìë™ìœ¼ë¡œ ë¦¬ë Œë”ë§
             */

            /**
             * Red ì»´í¬ë„ŒíŠ¸ ë Œë”ë§ í•¨ìˆ˜
             * store.subscribe()ì— ì˜í•´ ìƒíƒœ ë³€ê²½ ì‹œ ìë™ í˜¸ì¶œ
             */
            const renderRedComponent = () => {
                console.log("ğŸ”´ Red ì»´í¬ë„ŒíŠ¸ ë Œë”ë§ ì‹œì‘");

                // í˜„ì¬ ìƒíƒœë¥¼ storeì—ì„œ ê°€ì ¸ì˜¤ê¸°
                const currentState = store.getState();

                // ëŒ€ìƒ DOM ìš”ì†Œ ì°¾ê¸°
                const targetElement = document.querySelector("#red-component");

                // HTML í…œí”Œë¦¿ ë¦¬í„°ëŸ´ì„ ì‚¬ìš©í•œ ë™ì  ë Œë”ë§
                targetElement.innerHTML = `
                <div class="container" style="background-color: ${currentState.color}">
                    <h1>red</h1>
                    <input type="button" value="fire" onclick="handleColorChange('red')">
                </div>
            `;

                console.log("âœ… Red ì»´í¬ë„ŒíŠ¸ ë Œë”ë§ ì™„ë£Œ");
            };

            /**
             * Blue ì»´í¬ë„ŒíŠ¸ ë Œë”ë§ í•¨ìˆ˜
             */
            const renderBlueComponent = () => {
                console.log("ğŸ”µ Blue ì»´í¬ë„ŒíŠ¸ ë Œë”ë§ ì‹œì‘");

                const currentState = store.getState();
                const targetElement = document.querySelector("#blue-component");

                targetElement.innerHTML = `
                <div class="container" style="background-color: ${currentState.color}">
                    <h1>blue</h1>
                    <input type="button" value="fire" onclick="handleColorChange('blue')">
                </div>
            `;

                console.log("âœ… Blue ì»´í¬ë„ŒíŠ¸ ë Œë”ë§ ì™„ë£Œ");
            };

            /**
             * Green ì»´í¬ë„ŒíŠ¸ ë Œë”ë§ í•¨ìˆ˜
             */
            const renderGreenComponent = () => {
                console.log("ğŸŸ¢ Green ì»´í¬ë„ŒíŠ¸ ë Œë”ë§ ì‹œì‘");

                const currentState = store.getState();
                const targetElement = document.querySelector("#green-component");

                targetElement.innerHTML = `
                <div class="container" style="background-color: ${currentState.color}">
                    <h1>green</h1>
                    <input type="button" value="fire" onclick="handleColorChange('green')">
                </div>
            `;

                console.log("âœ… Green ì»´í¬ë„ŒíŠ¸ ë Œë”ë§ ì™„ë£Œ");
            };

            /**
             * =====================================================
             * EVENT HANDLERS
             * =====================================================
             */

            /**
             * ìƒ‰ìƒ ë³€ê²½ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬
             * ë²„íŠ¼ í´ë¦­ ì‹œ í˜¸ì¶œë˜ì–´ Redux ì•¡ì…˜ì„ ë””ìŠ¤íŒ¨ì¹˜
             * @param {string} color - ë³€ê²½í•  ìƒ‰ìƒ
             */
            const handleColorChange = (color) => {
                console.log(`ğŸ¯ ìƒ‰ìƒ ë³€ê²½ ìš”ì²­: ${color}`);

                // ì•¡ì…˜ ìƒì„±ìë¥¼ ì‚¬ìš©í•˜ì—¬ ì•¡ì…˜ ê°ì²´ ìƒì„±
                const action = changeColorAction(color);

                // Redux storeì— ì•¡ì…˜ ë””ìŠ¤íŒ¨ì¹˜
                // ì´ë¡œ ì¸í•´ reducerê°€ í˜¸ì¶œë˜ê³ , ìƒíƒœê°€ ë³€ê²½ë˜ë©°, êµ¬ë…ìë“¤ì´ ì‹¤í–‰ë¨
                store.dispatch(action);

                console.log("ğŸ“¤ ì•¡ì…˜ ë””ìŠ¤íŒ¨ì¹˜ ì™„ë£Œ:", action);
            };

            /**
             * =====================================================
             * SUBSCRIPTION & INITIALIZATION
             * =====================================================
             * Redux store êµ¬ë… ì„¤ì • ë° ì´ˆê¸° ë Œë”ë§
             */

            // ìƒíƒœ ë³€ê²½ ê°ì§€ë¥¼ ìœ„í•œ êµ¬ë…ì ë“±ë¡
            // store.subscribe()ëŠ” ìƒíƒœê°€ ë³€ê²½ë  ë•Œë§ˆë‹¤ ë“±ë¡ëœ í•¨ìˆ˜ë¥¼ ìë™ ì‹¤í–‰
            console.log("ğŸ‘‚ ì»´í¬ë„ŒíŠ¸ êµ¬ë…ì ë“±ë¡ ì¤‘...");

            store.subscribe(renderRedComponent);
            store.subscribe(renderBlueComponent);
            store.subscribe(renderGreenComponent);

            console.log("âœ… ëª¨ë“  êµ¬ë…ì ë“±ë¡ ì™„ë£Œ");

            /**
             * =====================================================
             * INITIAL RENDER
             * =====================================================
             * ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹œì‘ ì‹œ ì´ˆê¸° ë Œë”ë§ ìˆ˜í–‰
             */
            console.log("ğŸš€ ì´ˆê¸° ë Œë”ë§ ì‹œì‘...");

            // ê° ì»´í¬ë„ŒíŠ¸ ì´ˆê¸° ë Œë”ë§
            renderRedComponent();
            renderBlueComponent();
            renderGreenComponent();

            console.log("ğŸ‰ ì• í”Œë¦¬ì¼€ì´ì…˜ ì´ˆê¸°í™” ì™„ë£Œ!");

            /**
             * =====================================================
             * REDUX ë™ì‘ íë¦„ ì •ë¦¬
             * =====================================================
             *
             * 1ï¸âƒ£ ì‚¬ìš©ì ì¸í„°ë™ì…˜
             *    - ì‚¬ìš©ìê°€ ë²„íŠ¼ í´ë¦­
             *    - handleColorChange() í•¨ìˆ˜ ì‹¤í–‰
             *
             * 2ï¸âƒ£ ì•¡ì…˜ ìƒì„± ë° ë””ìŠ¤íŒ¨ì¹˜
             *    - changeColorAction()ìœ¼ë¡œ ì•¡ì…˜ ê°ì²´ ìƒì„±
             *    - store.dispatch()ë¡œ Redux storeì— ì•¡ì…˜ ì „ë‹¬
             *
             * 3ï¸âƒ£ Reducer ì‹¤í–‰
             *    - Reduxê°€ ìë™ìœ¼ë¡œ reducer í•¨ìˆ˜ í˜¸ì¶œ
             *    - í˜„ì¬ ìƒíƒœ(state)ì™€ ì•¡ì…˜(action)ì„ ë§¤ê°œë³€ìˆ˜ë¡œ ì „ë‹¬
             *
             * 4ï¸âƒ£ ìƒíƒœ ì—…ë°ì´íŠ¸
             *    - reducerê°€ ìƒˆë¡œìš´ ìƒíƒœ ê°ì²´ ë°˜í™˜
             *    - Reduxê°€ ìƒíƒœ ë³€ê²½ì„ ê°ì§€
             *
             * 5ï¸âƒ£ êµ¬ë…ì ì‹¤í–‰
             *    - store.subscribe()ë¡œ ë“±ë¡ëœ ëª¨ë“  í•¨ìˆ˜ë“¤ì´ ìë™ ì‹¤í–‰
             *    - ê° ì»´í¬ë„ŒíŠ¸ ë Œë”ë§ í•¨ìˆ˜ê°€ ìˆœì°¨ì ìœ¼ë¡œ í˜¸ì¶œ
             *
             * 6ï¸âƒ£ UI ì—…ë°ì´íŠ¸
             *    - store.getState()ë¡œ ìƒˆë¡œìš´ ìƒíƒœ ì¡°íšŒ
             *    - DOM ìš”ì†Œë“¤ì´ ìƒˆë¡œìš´ ìƒíƒœì— ë§ê²Œ ì—…ë°ì´íŠ¸
             *
             * ğŸ”„ ì´ ê³¼ì •ì´ ë§¤ë²ˆ ë°˜ë³µë˜ì–´ ìƒíƒœì™€ UIì˜ ë™ê¸°í™” ìœ ì§€
             */

            // ì „ì—­ í•¨ìˆ˜ë¡œ ë“±ë¡ (onclick í•¸ë“¤ëŸ¬ì—ì„œ ì‚¬ìš©í•˜ê¸° ìœ„í•¨)
            window.handleColorChange = handleColorChange;
        </script>
    </body>
</html>
